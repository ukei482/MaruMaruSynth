# Synthesizer Design Specification

## 1. コンセプト

- **コアコンセプト**: 自然音と電子音の有機的な融合。サンプリングや物理モデリングとは異なる、スペクトル解析を応用した新しいサウンドの創出を目指す。
- **サウンドの方向性**: Dorian Conceptに代表されるLo-fiかつ実験的なサウンド。DreamcoreやLiminal Spaceが持つ、ノスタルジックで非現実的な音響空間の表現。

---

## 2. コア技術

### 2.1. スペクトル解析と再構成
任意の音声ファイルをFFT（高速フーリエ変換）で周波数スペクトルに分解し、それを元にシンセシス（音響合成）を行う。これにより、元のサウンドが持つ倍音構造の「DNA」を抽出し、新たな音の素材として利用する。

### 2.2. ハイブリッド・シンセシスエンジン
用途に応じて選択可能な、2種類のシンセシス方式を実装する。
- **加算合成方式 (Additive Engine)**: 解析したスペクトルを多数のサイン波で再構築し、精密な音響制御を可能にする。
- **ウェーブテーブル方式 (Wavetable Engine)**: 解析結果からカスタムウェーブテーブルを生成し、直感的かつダイナミックな音色変化を実現する。

### 2.3. アナログフィール・シミュレーション
デジタル的なサウンドに有機的な質感を与えるための機能を実装する。
- **ワウ・フラッター**: テープマシン特有の周期的なピッチの揺らぎ。
- **リリースノイズ**: 鍵盤から指を離した際の物理的なノイズ（機構音、弦の余韻など）の付加。
- **レガート/ポルタメント**: 音高の滑らかな変化。

---

## 3. 音声解析プログラムの仕様

### 3.1. 入力
- WAV, AIFF形式のモノラル/ステレオ音声ファイル。

### 3.2. 解析プロセス
1.  ユーザーが読み込んだ波形上で **Attack / Core / Sustain** の3つの領域を手動で指定する。
    - ``
2.  **スペクトル解析**: 各領域に対し、FFTを実行。
    - **設定パラメータ**: ユーザーはFFTサイズ、ウィンドウ関数、ホップサイズを調整可能とし、解析の精度をコントロールできる。
3.  **ピッチ輪郭の抽出**: 元の音声の基音（F0）の時間的変化（ビブラートなど）を検出し、ピッチ変調データとして配列で保存する。
4.  **データ出力**:
    - **加算合成モード向け**: 各領域のスペクトラムデータ（周波数, 振幅, 位相）を出力。
    - **ウェーブテーブルモード向け**: スペクトラムデータからIFFT（逆高速フーリエ変換）を用いてウェーブテーブルを生成し、ピッチ変調データと共に出力。

---

## 4. シンセサイザーの仕様

### 4.1. 共通セクション
- **LFO x2**: ``
- **Filter**: Multi-mode Filter (LPF, HPF, BPF) with Resonance.
- **Envelope Generator x2**: ADSR形式 (AMP用, Filter/Modulation用).
- **Effects**:
    - Drive / Saturation
    - Chorus / Flanger
    - Delay (Tape Echoシミュレーション)
    - Reverb

### 4.2. Engine 1: 加算合成 (Additive Engine)
- **概要**: 解析されたスペクトラムを元に音を生成する。CPU負荷を考慮し、サイン波の生成には**ルックアップテーブル方式**を採用する。
- **パラメータ**:
    - **Spectrum Crossfade**: Attack, Core, Sustainの各スペクトラム間をモーフィングする時間とカーブを設定。これにより、滑らかな時間的音色変化を実現する。
    - **Harmonic Stretch**: 倍音構造を引き伸ばし、非整数倍音を強調することで金属的な響きを作り出す。
    - **Phase Randomization**: 位相のランダム性を調整し、音のキャラクターを硬質から軟質まで変化させる。

### 4.3. Engine 2: ウェーブテーブル (Wavetable Engine)
- **概要**: 自然音由来の「Natural Table」と、シンセサイザー内蔵の「Electronic Table」を組み合わせ、新たな音色を創出する。
- **再生方式**:
    - **音色 (Timbre)**: Wavetableの再生位置（Position）で制御する。
    - **音高 (Pitch)**: MIDIノートに加え、解析時に抽出した**ピッチ変調データ**を動的に適用し、元のサウンドの持つ揺らぎを再現する。
- **Fusion Method**:
    - **Morph**: Natural TableとElectronic Tableの波形を滑らかにモーフィングする。
    - **FM (Frequency Modulation)**: 片方のテーブル出力で、もう片方の周波数を変調し、複雑な倍音を生成する。
    - **Layer**: 二つのテーブルから生成したサウンドをミックスする。
- **Electronic Table**: ``

---

## 5. 主な設計判断と実装方針

- **CPU負荷対策**: 加算合成エンジンにおけるサイン波生成は、事前計算された配列を参照する**ルックアップテーブル方式**を導入し、リアルタイム性能を確保する。
- **時間変化の再現**: スペクトラムの時間的変化は、Attack/Core/Sustainの各スナップショット間を**クロスフェード**することで、シンプルかつ効果的に実現する。位相の不連続性は、意図したLo-fiサウンドへの貢献要素として許容する。
- **ピッチと音色の分離**: ウェーブテーブル方式では、**音色変化（テーブル位置）とピッチ変調（抽出データ）を明確に分離**するアーキテクチャを採用し、表現力と操作性を両立させる。